@echo off
echo ========================================
echo Building Process Manager GUI Executable
echo ========================================

cd /d "F:\MalwareAnalysis\ProcessManager"

echo.
echo [1/4] Checking PyInstaller installation...
python -c "import PyInstaller; print('PyInstaller version:', PyInstaller.__version__)" 2>nul
if %errorlevel% neq 0 (
    echo PyInstaller not found. Installing...
    pip install pyinstaller
    if %errorlevel% neq 0 (
        echo ERROR: Failed to install PyInstaller
        pause
        exit /b 1
    )
)

echo.
echo [2/4] Cleaning previous build...
if exist "build" rmdir /s /q "build"
if exist "dist" rmdir /s /q "dist"
if exist "ProcessManagerGUI.exe" del "ProcessManagerGUI.exe"

echo.
echo [3/4] Building executable with PyInstaller...
pyinstaller --clean process_manager_gui.spec

if %errorlevel% neq 0 (
    echo.
    echo ERROR: Build failed!
    echo Check the output above for errors.
    pause
    exit /b 1
)

echo.
echo [4/4] Moving executable to main directory...
if exist "dist\ProcessManagerGUI.exe" (
    move "dist\ProcessManagerGUI.exe" "ProcessManagerGUI.exe"
    echo.
    echo ========================================
    echo BUILD SUCCESSFUL!
    echo ========================================
    echo Executable created: ProcessManagerGUI.exe
    echo Size: 
    dir "ProcessManagerGUI.exe" | findstr "ProcessManagerGUI.exe"
    echo.
    echo The executable includes:
    echo - All required dependencies
    echo - Essential process files
    echo - Memory dump tools (procdump.exe, winpmem)
    echo - Protection system modules
    echo - Admin privileges (UAC prompt will appear)
    echo.
) else (
    echo ERROR: Executable not found in dist folder
    echo Check build output for errors
)

echo Cleaning up build files...
if exist "build" rmdir /s /q "build"
if exist "dist" rmdir /s /q "dist"

echo.
echo Build complete! Press any key to exit...
pause >nul
