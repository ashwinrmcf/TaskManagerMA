@echo off
REM Start Process Manager Daemon Service with Admin Rights

REM Check if running as administrator
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo Requesting administrator privileges...
    powershell -Command "Start-Process cmd -ArgumentList '/c cd /d %cd% && %~s0' -Verb RunAs"
    exit /b
)

echo.
echo ================================================================
echo          Starting Process Manager Daemon Service
echo ================================================================
echo.

cd /d "F:\MalwareAnalysis\ProcessManager"
set PYTHON_EXE=C:\Users\windows\AppData\Local\Programs\Python\Python313\python.exe

REM First, try to start the service
net start ProcessDaemonService >nul 2>&1

if %errorlevel% equ 0 (
    echo.
    echo ✓ Service started successfully!
    echo.
    echo The daemon is now running in the background:
    echo   - Monitoring for threats continuously
    echo   - Deleting malicious files automatically
    echo   - Tray app will show notifications
    echo.
    echo Close this window - daemon keeps running!
    echo.
) else (
    echo Service not running. Attempting to install and start...
    echo.
    
    REM Install the service
    "%PYTHON_EXE%" process_daemon_service.py install
    
    if %errorlevel% equ 0 (
        echo Service installed. Starting...
        "%PYTHON_EXE%" process_daemon_service.py start
        
        if %errorlevel% equ 0 (
            echo.
            echo ✓ Service installed and started successfully!
            echo.
            echo The daemon is now running in the background:
            echo   - Monitoring for threats continuously
            echo   - Deleting malicious files automatically
            echo   - Tray app will show notifications
            echo.
        ) else (
            echo ✗ Failed to start service after installation
        )
    ) else (
        echo ✗ Failed to install service
    )
)

pause
