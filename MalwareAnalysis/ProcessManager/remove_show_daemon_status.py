"""
Remove Show Daemon Status Button
This script removes the "Show Daemon Status" button from the main GUI
"""

import re

def remove_show_daemon_status_button():
    """Remove the Show Daemon Status button from main GUI"""
    
    print("üóëÔ∏è Removing Show Daemon Status button from main GUI...")
    
    try:
        # Read the main GUI file
        gui_file = "process_manager_gui.py"
        
        with open(gui_file, 'r', encoding='utf-8') as f:
            content = f.read()
        
        print("üìÅ Read GUI file successfully")
        
        # Remove Show Daemon Status button from main GUI
        print("üö´ Removing Show Daemon Status button...")
        
        # Remove the button creation and styling (the actual pattern from the code)
        button_creation_pattern = r'\s*self\.status_btn = QPushButton\("Show Daemon Status"\).*?self\.status_btn\.clicked\.connect\(self\.status_dialog\.show\)\s*\n'
        
        removed_count = 0
        if re.search(button_creation_pattern, content, flags=re.DOTALL):
            content = re.sub(button_creation_pattern, '\n', content, flags=re.DOTALL)
            removed_count += 1
            print("‚úÖ Removed button creation and styling")
        
        # Remove the button from layout
        layout_pattern = r'\s*daemon_layout\.addWidget\(self\.status_btn\)\s*\n'
        if re.search(layout_pattern, content):
            content = re.sub(layout_pattern, '', content)
            removed_count += 1
            print("‚úÖ Removed button from layout")
        
        # Button connections already handled in the creation pattern above
        print("üßπ Button connections already removed with button creation")
        
        # Write the modified content back
        with open(gui_file, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("‚úÖ Show Daemon Status button removed successfully!")
        print(f"\nüéØ Changes made:")
        print(f"‚Ä¢ Removed 'Show Daemon Status' button from main GUI")
        print(f"‚Ä¢ Cleaned up button references and connections")
        if removed_count > 0:
            print(f"‚Ä¢ Found and removed {removed_count} instances")
        
        return True
        
    except Exception as e:
        print(f"‚ùå Error removing Show Daemon Status button: {str(e)}")
        return False

def create_backup():
    """Create a backup of the original file"""
    
    try:
        import shutil
        from datetime import datetime
        
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_name = f"process_manager_gui_backup_show_status_{timestamp}.py"
        
        shutil.copy2("process_manager_gui.py", backup_name)
        print(f"üìã Backup created: {backup_name}")
        return True
        
    except Exception as e:
        print(f"‚ö†Ô∏è Could not create backup: {str(e)}")
        return False

def verify_button_removal():
    """Verify that the Show Daemon Status button was removed"""
    
    try:
        with open("process_manager_gui.py", 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Check if Show Daemon Status button still exists
        if 'QPushButton("Show Daemon Status")' in content:
            print("‚ö†Ô∏è Warning: Show Daemon Status button may still exist")
            return False
        else:
            print("‚úÖ Verification passed: Show Daemon Status button removed")
            return True
            
    except Exception as e:
        print(f"‚ö†Ô∏è Could not verify button removal: {str(e)}")
        return False

def main():
    """Main function to remove Show Daemon Status button"""
    
    print("üóëÔ∏è Show Daemon Status Button Removal Tool")
    print("=" * 50)
    print("This will remove:")
    print("‚Ä¢ Show Daemon Status button (from main GUI)")
    print("=" * 50)
    
    # Create backup first
    print("üìã Creating backup...")
    create_backup()
    
    # Remove button
    success = remove_show_daemon_status_button()
    
    if success:
        # Verify removal
        print("\nüîç Verifying button removal...")
        verified = verify_button_removal()
        
        if verified:
            print("\nüéâ Show Daemon Status button removal completed!")
            print("\nüìã What to do next:")
            print("1. Restart your GUI application")
            print("2. Check main GUI - 'Show Daemon Status' button should be gone")
            print("3. Only essential daemon controls should remain")
            print("4. Enjoy the cleaner interface!")
        else:
            print("\n‚ö†Ô∏è Button removal may be incomplete")
            print("Please check the GUI manually")
        
    else:
        print("\n‚ùå Button removal failed!")
        print("Please check the error messages above.")
    
    return success

if __name__ == "__main__":
    main()
