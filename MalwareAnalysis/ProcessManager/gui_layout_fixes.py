"""
GUI Layout Fixes for Process Manager
This script applies the requested layout changes:
1. Remove designer credit block
2. Move designer credit to status bar
3. Increase console output font size
4. Expand console output width
"""

import re

def apply_gui_layout_fixes():
    """Apply the requested GUI layout fixes"""
    
    print("ğŸ¨ Applying GUI layout fixes...")
    
    try:
        # Read the main GUI file
        gui_file = "process_manager_gui.py"
        
        with open(gui_file, 'r', encoding='utf-8') as f:
            content = f.read()
        
        print("ğŸ“ Read GUI file successfully")
        
        # Fix 1: Remove the designer credit block
        print("ğŸ—‘ï¸ Removing designer credit block...")
        
        # Find and remove the designer credit section
        credit_pattern = r'\s*# Designer Credit in bottom right corner.*?main_layout\.addLayout\(credit_layout\)\s*\n'
        content = re.sub(credit_pattern, '\n', content, flags=re.DOTALL)
        
        # Fix 2: Increase console output font size and expand width
        print("ğŸ“ Increasing console output font size and width...")
        
        # Update console output styling
        old_console_style = r'''self\.console_output\.setStyleSheet\("""
            QTextEdit \{
                background-color: #1e1e1e;
                color: #ffffff;
                font-family: 'Consolas', 'Courier New', monospace;
                font-size: 11px;
                border: 1px solid #444;
                padding: 8px;
            \}
        """\)'''
        
        new_console_style = '''self.console_output.setStyleSheet("""
            QTextEdit {
                background-color: #1e1e1e;
                color: #ffffff;
                font-family: 'Consolas', 'Courier New', monospace;
                font-size: 13px;
                border: 1px solid #444;
                padding: 8px;
                line-height: 1.2;
            }
        """)'''
        
        content = re.sub(old_console_style, new_console_style, content)
        
        # Fix 3: Adjust layout proportions to give more space to console
        print("ğŸ“ Adjusting layout proportions...")
        
        # Change the layout proportions from 2:1 to 3:2 (more space for console)
        content = content.replace(
            'main_layout.addWidget(left_widget, 2)  # 2/3 of the width',
            'main_layout.addWidget(left_widget, 3)  # 3/5 of the width'
        )
        
        content = content.replace(
            'main_layout.addWidget(console_group, 1)  # 1/3 of the width',
            'main_layout.addWidget(console_group, 2)  # 2/5 of the width'
        )
        
        # Fix 4: Update status bar to include designer credit
        print("ğŸ“ Adding designer credit to status bar...")
        
        # Find the status bar update line and modify it
        old_status_pattern = r'self\.statusBar\(\)\.showMessage\(f"Last refreshed: \{datetime\.now\(\)\.strftime\(\'%H:%M:%S\'\)\}"\)'
        new_status_line = 'self.statusBar().showMessage(f"Last refreshed: {datetime.now().strftime(\'%H:%M:%S\')} | Designed by Ashwin")'
        
        content = re.sub(old_status_pattern, new_status_line, content)
        
        # Fix 5: Increase console output height slightly
        print("ğŸ“ Increasing console output height...")
        
        content = content.replace(
            'self.console_output.setMaximumHeight(600)',
            'self.console_output.setMaximumHeight(650)'
        )
        
        # Write the modified content back
        with open(gui_file, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("âœ… GUI layout fixes applied successfully!")
        print("\nğŸ¯ Changes made:")
        print("â€¢ Removed designer credit block from right side")
        print("â€¢ Added designer credit to status bar after 'Last refreshed'")
        print("â€¢ Increased console output font size from 11px to 13px")
        print("â€¢ Expanded console output width (3:2 ratio instead of 2:1)")
        print("â€¢ Increased console output height from 600px to 650px")
        print("â€¢ Added line-height for better readability")
        
        return True
        
    except Exception as e:
        print(f"âŒ Error applying GUI layout fixes: {str(e)}")
        return False

def create_backup():
    """Create a backup of the original file"""
    
    try:
        import shutil
        from datetime import datetime
        
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_name = f"process_manager_gui_backup_{timestamp}.py"
        
        shutil.copy2("process_manager_gui.py", backup_name)
        print(f"ğŸ“‹ Backup created: {backup_name}")
        return True
        
    except Exception as e:
        print(f"âš ï¸ Could not create backup: {str(e)}")
        return False

def main():
    """Main function to apply layout fixes"""
    
    print("ğŸ¨ GUI Layout Fix Tool")
    print("=" * 50)
    
    # Create backup first
    print("ğŸ“‹ Creating backup...")
    create_backup()
    
    # Apply fixes
    success = apply_gui_layout_fixes()
    
    if success:
        print("\nğŸ‰ Layout fixes applied successfully!")
        print("\nğŸ“‹ What to do next:")
        print("1. Restart your GUI application")
        print("2. Check that the designer credit appears in the status bar")
        print("3. Verify console output has larger font and more space")
        print("4. Enjoy the improved layout!")
        
    else:
        print("\nâŒ Layout fixes failed!")
        print("Please check the error messages above.")
    
    return success

if __name__ == "__main__":
    main()
