# üõ°Ô∏è Advanced Malware Analysis System - Process Manager GUI

## üìö Table of Contents
- [System Overview](#system-overview)
- [Architecture](#architecture)
- [Core Components](#core-components)
- [File Dependencies](#file-dependencies)
- [Features](#features)
- [Integration Guide](#integration-guide)
- [Development Guide](#development-guide)
- [API Reference](#api-reference)

---

## üéØ System Overview

The **Process Manager GUI** (`process_manager_gui.py`) is a sophisticated 13,000+ line Python application for advanced malware analysis and threat detection. Built with PyQt5, it provides enterprise-grade security capabilities for detecting, analyzing, and neutralizing malware threats automatically.

### **Key Capabilities**
- üîç Real-time process monitoring with risk scoring
- üíæ Automated memory dump creation and analysis
- üß¨ Volatility 3/2 memory forensics integration
- ‚ö° Automated threat neutralization
- üìä Comprehensive forensic reporting

### **Target Audience**
- Security Researchers
- Malware Analysts
- Academic Researchers
- Cybersecurity Students

---

## üèóÔ∏è Architecture

### **System Architecture**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        GUI Layer (PyQt5)            ‚îÇ
‚îÇ   ‚Ä¢ MainWindow (Orchestrator)       ‚îÇ
‚îÇ   ‚Ä¢ ProcessMonitorTab               ‚îÇ
‚îÇ   ‚Ä¢ SecurityTab                     ‚îÇ
‚îÇ   ‚Ä¢ UnknownProcessDialog            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ    Core Analysis Engine             ‚îÇ
‚îÇ   ‚Ä¢ Risk Scoring Algorithm          ‚îÇ
‚îÇ   ‚Ä¢ Memory Dump Handler             ‚îÇ
‚îÇ   ‚Ä¢ Volatility Integration          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ    Protection Systems               ‚îÇ
‚îÇ   ‚Ä¢ Fortress Protection             ‚îÇ
‚îÇ   ‚Ä¢ Smart Aggressive Mode           ‚îÇ
‚îÇ   ‚Ä¢ Safe Targeted Mode              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ    Windows Integration              ‚îÇ
‚îÇ   ‚Ä¢ Process APIs (psutil)           ‚îÇ
‚îÇ   ‚Ä¢ Memory Access (ctypes)          ‚îÇ
‚îÇ   ‚Ä¢ WMI Integration                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Component Interaction**
```
process_manager_gui.py (Main)
    ‚îú‚îÄ‚îÄ countdown_dump_handler.py
    ‚îú‚îÄ‚îÄ fortress_protection_system.py
    ‚îú‚îÄ‚îÄ smart_aggressive_protection.py
    ‚îú‚îÄ‚îÄ malware_resistant_gui.py
    ‚îú‚îÄ‚îÄ safe_targeted_protection.py
    ‚îî‚îÄ‚îÄ process_daemon.py
```

---

## üîß Core Components

### **1. MainWindow Class**
**Location:** Lines 1-500
**Purpose:** Main application window and orchestrator

```python
class MainWindow(QMainWindow):
    """
    Manages:
    - Tab interface (Process/Security/Analysis)
    - Global event handling
    - Component initialization
    - Shutdown procedures
    """
```

### **2. ProcessMonitorTab**
**Location:** Lines 500-2500
**Purpose:** Real-time process monitoring

**Features:**
- Process tree with parent-child relationships
- Risk scoring (0-100 scale)
- CPU/Memory usage tracking
- Color-coded threat levels:
  - üü¢ Safe (0-20)
  - üü° Unknown (21-40)
  - üü† Suspicious (41-70)
  - üî¥ Dangerous (71-100)

### **3. UnknownProcessDialog**
**Location:** Lines 2500-4500
**Purpose:** Automated threat response

**Workflow:**
1. Detection ‚Üí Show threats
2. Auto-pause ‚Üí Suspend dangerous
3. Countdown ‚Üí 10-second timer
4. Memory dump ‚Üí Capture evidence
5. Analysis ‚Üí Forensic investigation
6. Termination ‚Üí Eliminate threats

### **4. SecurityTab**
**Location:** Lines 4500-7000
**Purpose:** Security analysis interface

**Capabilities:**
- Memory dump creation (Full/Targeted)
- Volatility analysis (170+ commands)
- Rapid analysis for large dumps
- Threat reporting

### **5. VolatilityWorker**
**Location:** Lines 7000-10000
**Purpose:** Background memory forensics

```python
class VolatilityWorker(QThread):
    """Executes Volatility analysis:
    - Profile detection
    - Symbol resolution
    - Command execution
    - Result processing
    """
```

---

## üìÅ File Dependencies

### **Essential Files Required**

| File | Purpose | Required |
|------|---------|----------|
| `process_manager_gui.py` | Main application | ‚úÖ Core |
| `countdown_dump_handler.py` | Memory dump management | ‚úÖ Yes |
| `fortress_protection_system.py` | Advanced protection | ‚úÖ Yes |
| `fortress_smart_patch.py` | Smart patching | ‚úÖ Yes |
| `smart_aggressive_protection.py` | Aggressive mode | ‚úÖ Yes |
| `safe_targeted_protection.py` | Safe mode | ‚úÖ Yes |
| `malware_resistant_gui.py` | Emergency backup | ‚úÖ Yes |
| `process_daemon.py` | Background monitor | ‚úÖ Yes |
| `startup_control_manager.py` | Startup control | ‚úÖ Yes |
| `windows_service_whitelist.py` | Whitelisting | ‚úÖ Yes |
| `essential_processes.txt` | Process whitelist | ‚úÖ Yes |
| `requirements.txt` | Dependencies | ‚úÖ Yes |
| `winpmem_mini.exe` | Memory dumper | ‚úÖ Yes |
| `procdump.exe` | Process dumper | ‚úÖ Yes |

### **Import Structure**
```python
# In process_manager_gui.py:
from countdown_dump_handler import CountdownDumpHandler
from fortress_protection_system import FortressProtection
from fortress_smart_patch import apply_smart_patch
from smart_aggressive_protection import SmartAggressive
```

---

## üöÄ Features

### **1. Process Risk Scoring**

```python
def calculate_risk_score(process_info):
    """Multi-factor risk assessment"""
    risk = 0
    
    # Known malware (100 points)
    if hash in MALWARE_HASHES:
        risk += 100
    
    # Suspicious name (40 points)
    if any(bad in name for bad in ['satan','ransom','crypt']):
        risk += 40
    
    # Temp location (30 points)
    if '\\temp\\' in path:
        risk += 30
    
    # Unsigned (20 points)
    if not has_signature:
        risk += 20
    
    # Network activity (40 points)
    if suspicious_connections:
        risk += 40
    
    return min(risk, 100)
```

### **2. Memory Analysis Pipeline**

```
Detection ‚Üí Risk Assessment ‚Üí Memory Dump ‚Üí 
Volatility Analysis ‚Üí Threat Identification ‚Üí 
Automated Response ‚Üí Cleanup ‚Üí Report
```

### **3. Protection Modes**

| Mode | Description | Aggressiveness |
|------|-------------|----------------|
| Safe | Balanced protection | Low |
| Aggressive | Active threat hunting | Medium |
| Fortress | Kernel-level defense | High |

---

## üîå Integration Guide

### **For Academic/Research Integration**

#### **1. Basic Integration**
```python
from process_manager_gui import MainWindow

class ResearchIntegration:
    def __init__(self):
        self.analyzer = MainWindow()
    
    def analyze_sample(self, path):
        """Analyze malware sample"""
        self.analyzer.show()
        results = self.analyzer.analyze_file(path)
        return results
```

#### **2. Custom Detection Rules**
```python
# Add to process_manager_gui.py
def add_custom_detection():
    """Add custom malware patterns"""
    MALWARE_PATTERNS['research'] = {
        'names': ['custommalware'],
        'paths': ['\\research\\'],
        'hashes': ['abc123...']
    }
```

#### **3. Database Integration**
```python
import sqlite3

def store_results(threat_data):
    """Store in research database"""
    conn = sqlite3.connect('research.db')
    conn.execute(
        'INSERT INTO threats VALUES (?,?,?,?)',
        (threat_data['name'], 
         threat_data['hash'],
         threat_data['risk'],
         threat_data['report'])
    )
```

---

## üíª Development Guide

### **Setup Instructions**

1. **Install Python 3.8+**
2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Required packages:**
   ```
   PyQt5>=5.15.0
   psutil>=5.8.0
   pywin32>=300
   volatility3>=2.0.0
   ```

4. **Run application:**
   ```bash
   python process_manager_gui.py
   ```

### **Modifying the Code**

#### **Adding Detection Patterns**
```python
# Location: Line ~1850
self.malware_patterns['new_threat'] = {
    'names': ['badware'],
    'risk_score': 80
}
```

#### **Adding UI Elements**
```python
# Location: Line ~500
custom_button = QPushButton("Custom Action")
custom_button.clicked.connect(self.custom_function)
layout.addWidget(custom_button)
```

#### **Adding Volatility Commands**
```python
# Location: Line ~9000
self.volatility_commands.append('windows.custom')
```

---

## üìñ API Reference

### **Main Classes**

#### **MainWindow**
```python
MainWindow()
    .show_unknown_dialog(processes)
    .create_memory_dump(target)
    .analyze_memory(dump_path)
    .terminate_process(pid)
```

#### **ProcessInfo**
```python
ProcessInfo:
    pid: int
    name: str
    exe_path: str
    risk_score: int
    risk_level: str
```

#### **VolatilityWorker**
```python
VolatilityWorker(dump_path)
    .run() -> Execute analysis
    .stop() -> Stop analysis
    
Signals:
    output_received(str)
    analysis_complete(dict)
    error_occurred(str)
```

### **Key Functions**

```python
# Process Management
get_all_processes() -> List[ProcessInfo]
calculate_process_risk(process) -> int
terminate_process(pid) -> bool

# Memory Analysis  
create_memory_dump(path) -> bool
run_volatility_analysis(dump) -> dict
run_rapid_analysis(dump) -> dict

# Protection
enable_protection(mode) -> bool
emergency_shutdown() -> bool
```

---

## üîÑ Automated Workflow

### **Complete Analysis Cycle**

```python
while True:
    # 1. Detect threats
    threats = detect_unknown_processes()
    
    # 2. Show dialog
    if threats:
        show_unknown_dialog(threats)
    
    # 3. Create dump
        dump = create_memory_dump()
    
    # 4. Analyze
        results = volatility_analysis(dump)
    
    # 5. Respond
        terminate_threats(results)
    
    # 6. Clean & restart
        cleanup_dumps()
        sleep(2)
```

---

## üéì Educational Use Cases

### **Cybersecurity Courses**
- Live malware demonstration
- Memory forensics training
- Incident response practice

### **Research Projects**
- Malware behavior analysis
- Detection algorithm development
- Threat intelligence gathering

### **Integration Examples**

#### **SIEM Integration**
```python
def send_to_siem(threat):
    requests.post(
        "https://siem.example.com/api",
        json=threat.to_dict()
    )
```

#### **Machine Learning**
```python
from sklearn.ensemble import RandomForestClassifier

def ml_detection(process):
    features = extract_features(process)
    prediction = model.predict([features])
    return prediction[0]
```

---

## üîß Troubleshooting

| Issue | Solution |
|-------|----------|
| Volatility fails | Run `python runtime_patch_application.py` |
| High memory usage | Limit commands in settings |
| GUI freezes | Ensure operations use threads |
| Access denied | Run as Administrator |

---

## üìä Performance Tips

1. **Memory optimization:**
   - Use generators for large datasets
   - Clear caches periodically
   
2. **Speed optimization:**
   - Enable rapid analysis for 8GB+ dumps
   - Use parallel processing

3. **Stability:**
   - Run protection in Safe mode
   - Monitor resource usage

---

## üìù Configuration

### **essential_processes.txt**
```
# System processes (never terminate)
System
csrss.exe
services.exe
lsass.exe

# Add your processes
python.exe
your_app.exe
```

---

## üö¶ Quick Start

1. **Launch:** `python process_manager_gui.py`
2. **Enable protection:** Security tab ‚Üí Enable
3. **Monitor:** Threats detected automatically
4. **Review:** Check logs in `F:\MalwareAnalysis\Logs`

---

## ‚ö†Ô∏è Important Notes

- **Run as Administrator** for full functionality
- **Educational/Research use only**
- **Test in isolated environment first**
- **Keep backups before modification**

---

**Documentation Version 1.0**
*For academic integration and research purposes*
