import os
import zipfile
import urllib.request
import shutil

def download_procdump():
    print("Downloading ProcDump from Microsoft...")
    
    # Create a temp directory
    temp_dir = "temp_procdump"
    os.makedirs(temp_dir, exist_ok=True)
    
    try:
        # Download ProcDump
        url = "https://download.sysinternals.com/files/Procdump.zip"
        zip_path = os.path.join(temp_dir, "Procdump.zip")
        
        print(f"Downloading {url}...")
        urllib.request.urlretrieve(url, zip_path)
        
        # Extract the zip file
        print("Extracting files...")
        with zipfile.ZipFile(zip_path, 'r') as zip_ref:
            zip_ref.extractall(temp_dir)
        
        # Find procdump.exe in the extracted files
        procdump_exe = None
        for root, _, files in os.walk(temp_dir):
            if "procdump.exe" in files:
                procdump_exe = os.path.join(root, "procdump.exe")
                break
        
        if procdump_exe:
            # Copy to current directory
            shutil.copy2(procdump_exe, ".")
            print("[SUCCESS] Successfully installed procdump.exe")
            print("You can now use ProcDump for faster process-specific memory dumps!")
        else:
            print("[ERROR] Could not find procdump.exe in the downloaded files")
            
    except Exception as e:
        print(f"[ERROR] Error downloading or extracting ProcDump: {str(e)}")
    finally:
        # Clean up temp directory
        if os.path.exists(temp_dir):
            shutil.rmtree(temp_dir, ignore_errors=True)

if __name__ == "__main__":
    download_procdump()
