"""
Remove Specific Buttons from Process List Dialog
This script removes:
1. Instant Neutralization button
2. Kill Selected button  
3. Dump Selected button
"""

import re

def remove_process_dialog_buttons():
    """Remove the specified buttons from the process dialog"""
    
    print("ğŸ—‘ï¸ Removing buttons from process list dialog...")
    
    try:
        # Read the main GUI file
        gui_file = "process_manager_gui.py"
        
        with open(gui_file, 'r', encoding='utf-8') as f:
            content = f.read()
        
        print("ğŸ“ Read GUI file successfully")
        
        # Remove Instant Neutralization button
        print("ğŸš« Removing Instant Neutralization button...")
        
        # Find and remove the instant neutralization button code
        instant_neutralization_pattern = r'\s*# Add instant neutralization button\s*\n\s*self\.neutralize_button = QPushButton\("Instant Neutralization"\).*?controls_layout\.addWidget\(self\.neutralize_button\)\s*\n'
        content = re.sub(instant_neutralization_pattern, '\n', content, flags=re.DOTALL)
        
        # Remove Dump Selected button
        print("ğŸš« Removing Dump Selected button...")
        
        dump_selected_pattern = r'\s*self\.dump_selected_btn = QPushButton\("Dump Selected"\).*?controls_layout\.addWidget\(self\.dump_selected_btn\)\s*\n'
        content = re.sub(dump_selected_pattern, '\n', content, flags=re.DOTALL)
        
        # Remove Kill Selected button
        print("ğŸš« Removing Kill Selected button...")
        
        kill_selected_pattern = r'\s*self\.kill_selected_btn = QPushButton\("Kill Selected"\).*?controls_layout\.addWidget\(self\.kill_selected_btn\)\s*\n'
        content = re.sub(kill_selected_pattern, '\n', content, flags=re.DOTALL)
        
        # Also remove any references to these buttons in method calls
        print("ğŸ§¹ Cleaning up button references...")
        
        # Remove button click connections if they exist separately
        content = re.sub(r'\s*self\.neutralize_button\.clicked\.connect\(self\.instant_ransomware_neutralization\)\s*\n', '', content)
        content = re.sub(r'\s*self\.dump_selected_btn\.clicked\.connect\(self\.dump_selected_processes\)\s*\n', '', content)
        content = re.sub(r'\s*self\.kill_selected_btn\.clicked\.connect\(self\.kill_selected_processes\)\s*\n', '', content)
        
        # Write the modified content back
        with open(gui_file, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("âœ… Buttons removed successfully!")
        print("\nğŸ¯ Changes made:")
        print("â€¢ Removed 'Instant Neutralization' button")
        print("â€¢ Removed 'Dump Selected' button")
        print("â€¢ Removed 'Kill Selected' button")
        print("â€¢ Cleaned up button references and connections")
        print("\nğŸ“‹ Remaining buttons in process dialog:")
        print("â€¢ Close Monitor button (kept)")
        print("â€¢ Any other control buttons (kept)")
        
        return True
        
    except Exception as e:
        print(f"âŒ Error removing buttons: {str(e)}")
        return False

def create_backup():
    """Create a backup of the original file"""
    
    try:
        import shutil
        from datetime import datetime
        
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_name = f"process_manager_gui_backup_buttons_{timestamp}.py"
        
        shutil.copy2("process_manager_gui.py", backup_name)
        print(f"ğŸ“‹ Backup created: {backup_name}")
        return True
        
    except Exception as e:
        print(f"âš ï¸ Could not create backup: {str(e)}")
        return False

def verify_button_removal():
    """Verify that the buttons were actually removed"""
    
    try:
        with open("process_manager_gui.py", 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Check if buttons still exist
        buttons_found = []
        
        if 'QPushButton("Instant Neutralization")' in content:
            buttons_found.append("Instant Neutralization")
        
        if 'QPushButton("Dump Selected")' in content:
            buttons_found.append("Dump Selected")
            
        if 'QPushButton("Kill Selected")' in content:
            buttons_found.append("Kill Selected")
        
        if buttons_found:
            print(f"âš ï¸ Warning: These buttons may still exist: {', '.join(buttons_found)}")
            return False
        else:
            print("âœ… Verification passed: All specified buttons removed")
            return True
            
    except Exception as e:
        print(f"âš ï¸ Could not verify button removal: {str(e)}")
        return False

def main():
    """Main function to remove buttons"""
    
    print("ğŸ—‘ï¸ Process Dialog Button Removal Tool")
    print("=" * 50)
    print("This will remove:")
    print("â€¢ Instant Neutralization button")
    print("â€¢ Dump Selected button")
    print("â€¢ Kill Selected button")
    print("=" * 50)
    
    # Create backup first
    print("ğŸ“‹ Creating backup...")
    create_backup()
    
    # Remove buttons
    success = remove_process_dialog_buttons()
    
    if success:
        # Verify removal
        print("\nğŸ” Verifying button removal...")
        verified = verify_button_removal()
        
        if verified:
            print("\nğŸ‰ Button removal completed successfully!")
            print("\nğŸ“‹ What to do next:")
            print("1. Restart your GUI application")
            print("2. Open the process list dialog")
            print("3. Verify that only 'Close Monitor' button remains")
            print("4. Enjoy the cleaner interface!")
        else:
            print("\nâš ï¸ Button removal may be incomplete")
            print("Please check the GUI manually")
        
    else:
        print("\nâŒ Button removal failed!")
        print("Please check the error messages above.")
    
    return success

if __name__ == "__main__":
    main()
