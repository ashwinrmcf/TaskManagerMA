# Move Essential Daemon Files to Daemon Folder
# This script organizes all daemon-related files into a dedicated Daemon folder

$sourceDir = "f:\MalwareAnalysis\ProcessManager"
$daemonDir = "f:\MalwareAnalysis\Daemon"

# Create subdirectories in Daemon folder
$subdirs = @(
    "$daemonDir\Scripts",
    "$daemonDir\Config",
    "$daemonDir\Tools",
    "$daemonDir\Icons",
    "$daemonDir\Docs"
)

foreach ($dir in $subdirs) {
    if (-not (Test-Path $dir)) {
        New-Item -ItemType Directory -Path $dir -Force | Out-Null
        Write-Host "Created directory: $dir"
    }
}

# Core daemon Python files
$coreDaemonFiles = @(
    "process_daemon_console.py",
    "process_daemon_service.py",
    "process_daemon.py",
    "process_manager_tray.py"
)

# Daemon startup scripts
$startupScripts = @(
    "startup_daemon_and_tray.bat",
    "run_daemon_background.bat",
    "start_daemon_console.bat",
    "install_background_daemon.bat",
    "start_daemon_service.bat",
    "install_daemon_service.py"
)

# Configuration files
$configFiles = @(
    "essential_processes.txt",
    "daemon_notifications.json",
    "file_deletion_notifications.json"
)

# Tool executables
$toolFiles = @(
    "procdump.exe",
    "winpmem_mini.exe",
    "winpmem_mini_x64_rc2.exe"
)

# Documentation files
$docFiles = @(
    "BACKGROUND_DAEMON_README.md",
    "DAEMON_CONSOLE_README.md",
    "SERVICE_README.md"
)

# Move core daemon files
Write-Host "`n=== Moving Core Daemon Files ===" -ForegroundColor Green
foreach ($file in $coreDaemonFiles) {
    $source = Join-Path $sourceDir $file
    $dest = Join-Path $daemonDir $file
    if (Test-Path $source) {
        Move-Item -Path $source -Destination $dest -Force
        Write-Host "‚úì Moved: $file"
    } else {
        Write-Host "‚úó Not found: $file"
    }
}

# Move startup scripts
Write-Host "`n=== Moving Startup Scripts ===" -ForegroundColor Green
foreach ($file in $startupScripts) {
    $source = Join-Path $sourceDir $file
    $dest = Join-Path "$daemonDir\Scripts" $file
    if (Test-Path $source) {
        Move-Item -Path $source -Destination $dest -Force
        Write-Host "‚úì Moved: $file"
    } else {
        Write-Host "‚úó Not found: $file"
    }
}

# Move configuration files
Write-Host "`n=== Moving Configuration Files ===" -ForegroundColor Green
foreach ($file in $configFiles) {
    $source = Join-Path $sourceDir $file
    $dest = Join-Path "$daemonDir\Config" $file
    if (Test-Path $source) {
        Move-Item -Path $source -Destination $dest -Force
        Write-Host "‚úì Moved: $file"
    } else {
        Write-Host "‚úó Not found: $file"
    }
}

# Move tool executables
Write-Host "`n=== Moving Tool Executables ===" -ForegroundColor Green
foreach ($file in $toolFiles) {
    $source = Join-Path $sourceDir $file
    $dest = Join-Path "$daemonDir\Tools" $file
    if (Test-Path $source) {
        Move-Item -Path $source -Destination $dest -Force
        Write-Host "‚úì Moved: $file"
    } else {
        Write-Host "‚úó Not found: $file"
    }
}

# Move documentation files
Write-Host "`n=== Moving Documentation Files ===" -ForegroundColor Green
foreach ($file in $docFiles) {
    $source = Join-Path $sourceDir $file
    $dest = Join-Path "$daemonDir\Docs" $file
    if (Test-Path $source) {
        Move-Item -Path $source -Destination $dest -Force
        Write-Host "‚úì Moved: $file"
    } else {
        Write-Host "‚úó Not found: $file"
    }
}

# Move Icons folder
Write-Host "`n=== Moving Icons Folder ===" -ForegroundColor Green
$iconsSource = Join-Path $sourceDir "Icons"
$iconsDest = Join-Path $daemonDir "Icons"
if (Test-Path $iconsSource) {
    if (Test-Path $iconsDest) {
        Remove-Item $iconsDest -Recurse -Force
    }
    Move-Item -Path $iconsSource -Destination $iconsDest -Force
    Write-Host "‚úì Moved: Icons folder"
} else {
    Write-Host "‚úó Icons folder not found"
}

# Display final structure
Write-Host "`n=== Final Daemon Folder Structure ===" -ForegroundColor Cyan
Get-ChildItem -Path $daemonDir -Recurse | ForEach-Object {
    $indent = "  " * ($_.FullName.Split('\').Count - $daemonDir.Split('\').Count)
    if ($_.PSIsContainer) {
        Write-Host "$indentüìÅ $($_.Name)/"
    } else {
        Write-Host "$indentüìÑ $($_.Name)"
    }
}

Write-Host "`n‚úì Daemon files organization complete!" -ForegroundColor Green
Write-Host "All essential daemon files have been moved to: $daemonDir" -ForegroundColor Green
