import os
import socket
import time
import tempfile

# Give the process a suspicious name (when run with pythonw or pyinstaller, etc.)
# Optionally, rename the script file to svch0st.exe or similar for more realism

def create_dummy_file():
    temp_dir = tempfile.gettempdir()
    dummy_path = os.path.join(temp_dir, "suspicious_agent_dump.tmp")
    with open(dummy_path, "w") as f:
        f.write("This is a harmless test file.\n")
    return dummy_path

def open_dummy_port():
    # Open a local TCP port (won't accept connections, just to look suspicious)
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    try:
        s.bind(("127.0.0.1", 44444))  # Port 44444 is rarely used
        s.listen(1)
        return s
    except Exception:
        return None

def main():
    print("[SuspiciousAgent] Running harmless suspicious process...")
    dummy_file = create_dummy_file()
    sock = open_dummy_port()
    try:
        while True:
            time.sleep(10)  # Stay alive, low CPU
    except KeyboardInterrupt:
        pass
    finally:
        if sock:
            sock.close()
        if os.path.exists(dummy_file):
            os.remove(dummy_file)

if __name__ == "__main__":
    main()
