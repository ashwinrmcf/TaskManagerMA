# üõ°Ô∏è Malware Analysis Daemon - Complete User Guide

## Table of Contents
1. [What is the Daemon?](#what-is-the-daemon)
2. [How to Start](#how-to-start)
3. [Understanding Each Component](#understanding-each-component)
4. [What Happens During a Scan](#what-happens-during-a-scan)
5. [Reading the Reports](#reading-the-reports)
6. [Quarantine & Cleanup](#quarantine--cleanup)
7. [Troubleshooting](#troubleshooting)

---

## What is the Daemon?

The **Malware Analysis Daemon** is an automated security system that:
- üîç **Scans** your computer for malicious programs
- üéØ **Detects** threats using advanced analysis
- üõë **Stops** dangerous processes automatically
- üìä **Analyzes** memory and behavior
- üìã **Reports** findings in detail
- üßπ **Cleans up** safely

**In simple terms**: It's like a security guard that never sleeps, constantly watching for bad programs and stopping them before they can harm your system.

---

## How to Start

### Starting the Daemon

Open PowerShell and run:
```powershell
python f:\MalwareAnalysis\Daemon\enhanced_pre_analyzer_monitor.py
```

### What You'll See

```
================================================================================
              üõ°Ô∏è  ENHANCED PRE-ANALYZER - CONTINUOUS MONITORING üõ°Ô∏è
================================================================================

[14:06:34] Initializing enhanced malware detector...
[14:06:34] Loaded 784 whitelisted processes from essential_processes.txt
[14:06:34] Starting continuous monitoring loop
[14:06:34] Press Ctrl+C to stop
```

**This means**: The daemon is ready and watching your system.

### Stopping the Daemon

Press `Ctrl+C` in the PowerShell window.

---

## Understanding Each Component

### 1Ô∏è‚É£ PreAnalyzer - The Scanner

**What it does**: Scans all running programs on your computer

**How it works**:
1. Lists all active processes (programs)
2. Checks each one against a whitelist of safe programs
3. Analyzes suspicious programs for malware signatures
4. Scores each program's threat level (0-100)

**What you see**:
```
[14:06:34] Scanned 166 processes
[14:06:34] üö® THREATS DETECTED: 1

PID      Name                    Threat          Score    Level
---------------------------------------------------------------------------
6776     python.exe              RANSOMWARE      80       CRITICAL
```

**Threat Levels**:
- üü¢ **SAFE** (0-30): No danger
- üü° **LOW** (31-50): Monitor but not urgent
- üü† **MEDIUM** (51-70): Suspicious, needs attention
- üî¥ **HIGH** (71-85): Very dangerous
- üî¥ **CRITICAL** (86-100): Immediate threat

---

### 2Ô∏è‚É£ Memory Dumper - The Snapshot Taker

**What it does**: Creates a snapshot of a suspicious program's memory

**Why it matters**: Memory contains evidence of what the program was doing (stealing data, connecting to hackers, etc.)

**How it works**:
1. Pauses the suspicious program
2. Copies its memory to a file (2-4GB)
3. Saves it for analysis

**What you see**:
```
[14:06:41] Creating memory dump (this may take a few minutes)...
[14:06:42] Dump progress: 100/3072MB (3.3%)
[14:06:43] Dump progress: 307/3072MB (10.0%)
...
[14:06:53] Memory dump completed successfully
```

**Time**: Usually 10-30 seconds depending on system

---

### 3Ô∏è‚É£ Volatility Analyzer - The Detective

**What it does**: Examines the memory dump to find evidence of malicious activity

**Evidence it looks for**:
- Injected code (code hidden inside other programs)
- Network connections to suspicious servers
- File modifications
- Registry changes
- Running hidden processes
- Privilege escalation attempts

**How it works**:
1. Runs 44 different analysis commands
2. Extracts information from memory
3. Looks for malware signatures
4. Builds a threat profile

**What you see**:
```
[1/44] System Info... ‚úì
[2/44] Process List... ‚úì
[3/44] Process Tree... ‚úì
...
[44/44] Statistics... ‚úì
```

**Result**: A detailed forensic report

---

### 4Ô∏è‚É£ Threat Terminator - The Enforcer

**What it does**: Takes action against confirmed threats

**Actions it takes**:
1. ‚úã **Suspends** the malicious process (stops it)
2. üì¶ **Quarantines** the file (moves it to safe storage)
3. üóëÔ∏è **Deletes** the original malicious file
4. üíÄ **Terminates** the process completely

**Safety Features**:
- ‚úÖ Never deletes system files
- ‚úÖ Never terminates essential Windows processes
- ‚úÖ Protects interpreters (Python, PowerShell, etc.)
- ‚úÖ Only deletes actual malware scripts

**What you see**:
```
[14:06:35] Step 1: Suspending process python.exe (PID: 6776)
[SUSPENDED] Process python.exe (PID: 6776) has been suspended
[14:06:35] Step 2: Quarantining malicious file
[QUARANTINED] ransomware_test.py ‚Üí F:\MalwareAnalysis\Daemon\Quarantine\...
[14:06:35] Step 3: Terminating process python.exe (PID: 6776)
[TERMINATED] Process python.exe (PID: 6776) has been killed
```

---

### 5Ô∏è‚É£ Report Generator - The Documentarian

**What it does**: Creates detailed reports about threats and actions taken

**Report Types**:

#### Markdown Report (Human-Readable)
- Easy to read in any text editor
- Shows all findings in organized format
- Location: `Reports/MarkdownReports/`

#### JSON Report (Machine-Readable)
- Structured data format
- Used by other security tools
- Location: `Reports/JSONReports/`

**What's in the reports**:
- Threat detected
- Risk score and level
- Indicators of compromise
- Actions taken
- Recommendations
- Timestamp

**Example**:
```
THREAT DETECTED: python.exe
Risk Score: 80/100
Threat Level: CRITICAL
Threat Type: RANSOMWARE

Indicators:
- Ransomware keyword: ransomware
- Ransomware keyword: ransomware_test
- Suspicious execution path: temp

Actions Taken:
‚úì Process suspended
‚úì File quarantined
‚úì Process terminated
```

---

### 6Ô∏è‚É£ Memory Dumper - The Cleaner

**What it does**: Automatically deletes old memory dumps to save space

**How it works**:
1. Keeps only the latest memory dump
2. Deletes all older dumps
3. Reports space freed

**What you see**:
```
‚úì DELETED: TargetedDumps/TargetedKernelDump_python.exe_20251125_140531.raw (2904.0MB)
‚úì DELETED: TargetedDumps/TargetedKernelDump_python.exe_20251120_223634.raw (3072.0MB)
‚úì DELETED: MinimalDumps/MinimalDump_python_20251118_224145.raw (100.0MB)

Cleanup Summary:
  Dumps Deleted: 20
  Space Freed: 6676.6MB
```

---

## What Happens During a Scan

### Complete Workflow (Step by Step)

```
START
  ‚Üì
1. PreAnalyzer Scans
   ‚îî‚îÄ Checks all 150-200 running processes
   ‚îî‚îÄ Identifies suspicious ones
   ‚Üì
2. Threat Detected?
   ‚îú‚îÄ NO ‚Üí Continue monitoring (5 second wait)
   ‚îî‚îÄ YES ‚Üí Go to step 3
   ‚Üì
3. Memory Dumper Creates Snapshot
   ‚îî‚îÄ Pauses suspicious process
   ‚îî‚îÄ Copies memory (2-4GB)
   ‚îî‚îÄ Saves to disk
   ‚Üì
4. Volatility Analyzer Investigates
   ‚îî‚îÄ Runs 44 analysis commands
   ‚îî‚îÄ Searches for malware evidence
   ‚îî‚îÄ Builds threat profile
   ‚Üì
5. Threat Terminator Takes Action
   ‚îî‚îÄ Suspends process
   ‚îî‚îÄ Quarantines file
   ‚îî‚îÄ Deletes original
   ‚îî‚îÄ Terminates process
   ‚Üì
6. Report Generator Documents
   ‚îî‚îÄ Creates detailed reports
   ‚îî‚îÄ Saves findings
   ‚Üì
7. Memory Cleaner Cleans Up
   ‚îî‚îÄ Deletes old dumps
   ‚îî‚îÄ Frees disk space
   ‚Üì
8. Auto-Restart
   ‚îî‚îÄ Asks about quarantined files
   ‚îî‚îÄ Restarts monitoring
   ‚Üì
REPEAT (Every 5 seconds)
```

---

## Reading the Reports

### Where to Find Reports

**Markdown Reports** (Easy to read):
```
F:\MalwareAnalysis\Daemon\Reports\MarkdownReports\
```

**JSON Reports** (For tools):
```
F:\MalwareAnalysis\Daemon\Reports\JSONReports\
```

### Understanding a Report

#### Threat Summary
```
THREAT DETECTED: python.exe
Risk Score: 80/100
Threat Level: CRITICAL
Threat Type: RANSOMWARE
```
**What it means**: A critical threat was found with 80% confidence

#### Indicators
```
Indicators:
- Ransomware keyword: ransomware
- Ransomware keyword: ransomware_test
- Suspicious execution path: temp
```
**What it means**: Multiple signs point to ransomware

#### Actions Taken
```
Actions Completed:
‚úì Process suspended and terminated
‚úì File quarantined safely
‚úì Memory forensics completed
‚úì Behavioral analysis performed
```
**What it means**: The threat was handled automatically

#### Recommendations
```
Recommendations:
1. Review quarantined files
2. Check for data theft
3. Update security software
4. Monitor system for changes
```
**What it means**: Steps to take after threat removal

---

## Quarantine & Cleanup

### What is Quarantine?

**Quarantine** = Safe storage for dangerous files

- Files are moved to: `F:\MalwareAnalysis\Daemon\Quarantine\`
- They cannot run or spread
- They are preserved for analysis
- You can delete them later

### Quarantine Prompt

After each scan cycle, you'll see:
```
[14:15:47] Quarantined items: 2
[14:15:47] Auto-delete in 15 seconds if no response...

Delete quarantined files? (y/n):
```

**Options**:
- Type `y` and press Enter ‚Üí Delete quarantined files
- Type `n` and press Enter ‚Üí Keep quarantined files
- Do nothing ‚Üí Auto-deletes after 15 seconds

### Viewing Quarantined Files

```
F:\MalwareAnalysis\Daemon\Quarantine\
```

Each quarantined file is in a folder with timestamp:
```
quarantine_20251125_140635_ransomware_test\
  ‚îî‚îÄ ransomware_test.py
```

---

## Troubleshooting

### Problem: Daemon Won't Start

**Error**: `ModuleNotFoundError: No module named 'psutil'`

**Solution**:
```powershell
pip install psutil colorama pathlib
```

---

### Problem: High CPU Usage

**Cause**: Volatility analysis running (normal)

**Solution**: Wait 2-3 minutes, it will finish

---

### Problem: Disk Space Running Out

**Cause**: Memory dumps are large (2-4GB each)

**Solution**: Daemon automatically cleans old dumps. Check:
```
F:\MalwareAnalysis\MemoryDumps\
```

---

### Problem: False Positive (Safe Program Flagged)

**Example**: Windsurf installer showing as threat

**Solution**: 
1. Check if it's in whitelist: `Config/essential_processes.txt`
2. If legitimate, add to whitelist
3. Restart daemon

---

### Problem: Process Not Terminating

**Cause**: Permission issues or system process

**Solution**:
1. Check if it's a system process
2. Run PowerShell as Administrator
3. Manually terminate if needed

---

## Key Features Summary

| Feature | What It Does | Benefit |
|---------|-------------|---------|
| **Continuous Monitoring** | Scans every 5 seconds | Never misses threats |
| **Automatic Response** | Stops threats instantly | No manual intervention |
| **Memory Forensics** | Deep analysis of threats | Finds hidden malware |
| **Safe Quarantine** | Isolates dangerous files | Prevents spread |
| **Auto Cleanup** | Deletes old dumps | Saves disk space |
| **Detailed Reports** | Documents everything | Audit trail |
| **Grace Period** | Avoids re-detection | Reduces false alerts |
| **Whitelist** | Trusts safe programs | Fewer false positives |

---

## Important Safety Notes

‚úÖ **The daemon will**:
- Protect Windows system files
- Protect essential processes
- Protect interpreters (Python, PowerShell)
- Quarantine before deleting
- Log all actions

‚ùå **The daemon will NOT**:
- Delete system files
- Terminate Windows processes
- Modify registry without reason
- Delete legitimate programs

---

## Getting Help

### Check Logs
```
F:\MalwareAnalysis\Daemon\Logs\
```

### Review Reports
```
F:\MalwareAnalysis\Daemon\Reports\
```

### Check Quarantine
```
F:\MalwareAnalysis\Daemon\Quarantine\
```

---

## Quick Reference

### Start Daemon
```powershell
python f:\MalwareAnalysis\Daemon\enhanced_pre_analyzer_monitor.py
```

### Stop Daemon
```
Press Ctrl+C
```

### View Reports
```
F:\MalwareAnalysis\Daemon\Reports\
```

### View Quarantine
```
F:\MalwareAnalysis\Daemon\Quarantine\
```

### View Logs
```
F:\MalwareAnalysis\Daemon\Logs\
```

---

**Version**: 1.0  
**Last Updated**: November 25, 2025  
**Status**: Production Ready ‚úÖ
